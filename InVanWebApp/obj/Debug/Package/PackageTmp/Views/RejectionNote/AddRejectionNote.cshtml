
@model InVanWebApp_BO.RejectionNoteBO

@{
    ViewBag.Title = "AddRejectionNote";
    Layout = "~/Views/Shared/MainMaster.cshtml";
}


@using (Html.BeginForm("AddRejectionNote", "RejectionNote", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    <div class="card">
        <div class="card-body">
            @*//Rahul removed extra text 'Note' 16-02-23.*@
            <h4>Add Rejection Note</h4>
            <hr />
            @Html.ValidationSummary(true)

            <div class="row">
                <div class="col-md-2">
                    @Html.Label("Rejection Note Number")
                    <span style="color:red">*</span>
                </div>
                <div class="col-md-4">
                    @Html.TextBoxFor(model => model.RejectionNoteNo, new { @class = "form-control form-control-sm", Value = ViewData["DocumentNo"], @readonly = "readonly" })
                    @Html.ValidationMessageFor(model => model.RejectionNoteNo, "", new { @class = "error mt-2 text-danger" })
                </div>
                <div class="col-md-2">
                    <label id="lblNoteDate">Rejection Note Date</label>
                    <span style="color:red">*</span>
                </div>
                <div class="col-md-4">
                    @Html.TextBoxFor(model => model.NoteDate, "{0:yyyy-MM-dd}", new { @class = "form-control form-control-sm", type = "date",@readonly="readonly" })
                    @Html.ValidationMessageFor(model => model.NoteDate, "", new { @class = "error mt-2 text-danger" })
                </div>
            </div>
            <br />    @*//Rahul 18 Apr 23.*@
            <div class="row">
                <div class="col-md-2">
                    <label>QC Type <span style="color:red">*</span> </label>
                </div>
                <div class="col-md-4">
                    <select class="form-control form-control-sm DropdownRegular" id="QCType" name="QCType">
                        <option value="InwardQC">Inward QC</option>
                        <option value="PreProductionQC">Pre Production QC</option>
                    </select>
                </div>
            </div>
            <br />    @*//Rahul 18 Apr 23.*@
            <div id="divInwardQC" style="display:none;">
                <div class="row">
                    <div class="col-md-2">
                        @*Inward Number*@   @*Rahul added Label+span 08-02-23.*@
                        @Html.Label("Inward QC Number")
                        <span style="color:red">*</span>
                    </div>
                    <div class="col-md-4">
                        @Html.DropDownListFor(model => model.InwardQCId, (IEnumerable<SelectListItem>)ViewData["InwardNumber"], "--Select--",
                                                      new { @class = "form-control form-control-sm", onchange = "SelectedIndexChanged($(this).val())" })
                        @Html.ValidationMessageFor(model => model.InwardQCId, "", new { id = "ValMsgInwardQCNumber", @class = "error mt-2 text-danger" })
                        <span id="ValMsgInwardQCNumber" style="display:none;" class="error mt-2 text-danger field-validation-error">Please select Inward QC number!</span>  @*///Rahul added 19-04-23.*@
                        @Html.HiddenFor(model => model.InwardQCNumber)
                        @Html.HiddenFor(model => model.InwardNoteNumber)
                    </div>
                    <div class="col-md-2">
                        @Html.Label("PO Number")
                        <span style="color:red">*</span>
                    </div>
                    <div class="col-md-4">
                        @Html.TextBoxFor(model => model.PONumber, new { @class = "form-control form-control-sm", @readonly = "readonly" })
                        @Html.ValidationMessageFor(model => model.PONumber, "", new { id = "ValMsgPONumber", @class = "error mt-2 text-danger" })
                    </div>
                    @Html.HiddenFor(model => model.PO_Id)
                </div>
                <br />
                <div class="row">
                    <div class="col-md-2">
                        @Html.Label("Supplier Name")
                        <span style="color:red">*</span>
                    </div>
                    <div class="col-md-4">
                        @Html.TextBoxFor(model => model.SupplierName, new { @class = "form-control form-control-sm", @readonly = "readonly" })
                        @Html.ValidationMessageFor(model => model.SupplierName, "", new { id = "ValMgssuppliername", @class = "error mt-2 text-danger" })
                    </div>
                    <div class="col-md-4 d-none">
                        @Html.TextBoxFor(model => model.SupplierID, new { @class = "form-control form-control-sm", Value = "", @readonly = "readonly" })
                    </div>
                </div>
            </div>
            <br />  @*//Rahul 18 Apr 23.*@
            <div id="divProductionQC" style="display:none;">
                <div class="row">
                    <div class="col-md-2">
                        @*Inward Number*@   @*Rahul added Label+span 08-02-23.*@
                        @Html.Label("Pre-Production QC Number")
                        <span style="color:red">*</span>
                    </div>
                    <div class="col-md-4">
                        @Html.DropDownListFor(model => model.PreProductionQCId, (IEnumerable<SelectListItem>)ViewData["PreProductionQCAndId"], "--Select--",
                                            new { @class = "form-control form-control-sm", onchange = "SelectedIndexChangedProduction($(this).val())" })
                        @Html.ValidationMessageFor(model => model.PreProductionQCId, "", new { id = "ValMsgProductionQCNumber", @class = "error mt-2 text-danger" })
                        <span id="ValMsgProductionQCNumber" style="display:none;" class="error mt-2 text-danger field-validation-error">Select Production QC!</span>
                        @Html.HiddenFor(model => model.PreProductionQCNumber)
                        @Html.HiddenFor(model => model.ProductionMaterialIssueNoteNo)
                        @Html.HiddenFor(model => model.ProductionMaterialIssueNoteId)
                    </div>
                    <div class="col-md-2">
                        @Html.Label("Production Indent Number")
                        <span style="color:red">*</span>
                    </div>
                    <div class="col-md-4">
                        @Html.TextBoxFor(model => model.ProductionIndentNo, new { @class = "form-control form-control-sm", @readonly = "readonly" })
                        @Html.ValidationMessageFor(model => model.ProductionIndentNo, "", new { id = "ValMsgProductionIndentNumber", @class = "error mt-2 text-danger" })
                        <span id="ValMsgProductionIndentNumber" style="display:none;" class="error mt-2 text-danger field-validation-error">Enter Production Indent Number!</span>
                    </div>
                    @Html.HiddenFor(model => model.ProductionIndentId)
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-md-2">
                    @Html.Label("Item QC details")
                </div>
            </div>
            <hr />
            <div class="row">
                @*Rahul added class table-responsive in div tag 09-02-23.*@
                <div class="col-md-12 table-responsive">
                    @*Rahul removed class table-responsive from table tag 09-02-23.*@
                    <table class="table table-striped" id="ItemTable">
                        <tr>
                            <th>Item</th>
                            <th>Code</th>
                            <th>Unit Price</th>
                            <th>Unit</th>
                            <th id="TotalQtyTextChange">Total Quantity</th>
                            <th id="InwardQtyTextChange">Inward Quantity</th>
                            <th>Rejected Quantity</th>
                            <th>Quantity took for Sorting (Kg)</th>
                            <th>Wastage (%)</th>
                            <th>Remarks</th>
                            <th class="d-none" hidden>ItemId</th>
                            <th class="d-none" hidden>Item Tax</th>
                        </tr>
                    </table>
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-md-2">
                    @Html.Label("Remarks")
                </div>
                <div class="col-md-4">
                    @Html.TextBoxFor(model => model.Remarks, new { @class = "form-control form-control-sm" })
                    @Html.ValidationMessageFor(model => model.Remarks, "", new { @class = "error mt-2 text-danger" })
                </div>
            </div>
            <br />
            <a href="@Url.Action("Index", "RejectionNote")" class="btn btn-sm btn-primary" style="background: linear-gradient(85deg, #392c70, #6a005b); float: right;">
                Back To List
            </a>
            <button type="submit" id="btnSave" class="btn btn-sm btn-primary mr-2" style="background: linear-gradient(85deg, #392c70, #6a005b);float:right;" onclick="SetInwardQty()">Save</button>

        </div>
    </div>
        
    @Html.TextBoxFor(model => model.InwardQuantities, new { style = "display:none" })
    
}

<script src="~/Scripts/jquery-3.4.1.js" type="text/javascript"></script>
<script src="~/Scripts/jquery-3.4.1.min.js" type="text/javascript"></script>
<link href="~/Theme/MainContent/css/CustomDropdown.css" rel="stylesheet" />

<script type="text/javascript">

    /*Shweta added 'function create_custom_dropdowns()' 22-06-2023. start*/

    function create_custom_dropdowns_InwardQCId() {
        $('select#InwardQCId').each(function (i, select) {

            if (!$(this).next().hasClass('dropdown-select')) {

                $('#InwardQCId').removeClass('form-control');
                $(this).after('<div id="divInwardQCId" class="dropdown-select wide d-flex align-items-center' + ($(this).attr('class') || '') + '" tabindex="0"><span class="current"></span><div class="list"><ul></ul></div></div>');
                var dropdown = $(this).next();
                var options = $(select).find('option');
                var selected = $(this).find('option:selected');
                dropdown.find('.current').html(selected.data('display-text') || selected.text());
                options.each(function (j, o) {
                    var display = $(o).data('display-text') || '';
                    dropdown.find('ul').append('<li class="option ' + ($(o).is(':selected') ? 'selected' : '') + '" data-value="' + $(o).val() + '" data-display-text="' + display + '">' + $(o).text() + '</li>');
                });
            }
        });
        $('#divInwardQCId.dropdown-select ul').before('<div class="dd-search"><input id="txtSearchValueInwardQCId" autocomplete="off" onkeyup="filterInwardQCId()" class="dd-searchbox" type="text" placeholder="Search for list" ><br />&nbsp;<span id="faSearch"><i class="fas fa-search"></i></span></div>');
    }
    function filterInwardQCId() {
        var valThis = $('#txtSearchValueInwardQCId').val();
        $('.dropdown-select ul > li').each(function () {
            var text = $(this).text();
            (text.toLowerCase().indexOf(valThis.toLowerCase()) > -1) ? $(this).show() : $(this).hide();
        });
    };

    function create_custom_dropdowns_PreProductionQCId() {
        $('select#PreProductionQCId').each(function (i, select) {

            if (!$(this).next().hasClass('dropdown-select')) {

                $('#PreProductionQCId').removeClass('form-control');
                $(this).after('<div id="divPreProductionQCId" class="dropdown-select wide d-flex align-items-center' + ($(this).attr('class') || '') + '" tabindex="0"><span class="current"></span><div class="list"><ul></ul></div></div>');
                var dropdown = $(this).next();
                var options = $(select).find('option');
                var selected = $(this).find('option:selected');
                dropdown.find('.current').html(selected.data('display-text') || selected.text());
                options.each(function (j, o) {
                    var display = $(o).data('display-text') || '';
                    dropdown.find('ul').append('<li class="option ' + ($(o).is(':selected') ? 'selected' : '') + '" data-value="' + $(o).val() + '" data-display-text="' + display + '">' + $(o).text() + '</li>');
                });
            }
        });
        $('#divPreProductionQCId.dropdown-select ul').before('<div class="dd-search"><input id="txtSearchValuePreProductionQCId" autocomplete="off" onkeyup="filterPreProductionQCId()" class="dd-searchbox" type="text" placeholder="Search for list" ><br />&nbsp;<span id="faSearch"><i class="fas fa-search"></i></span></div>');
    }
    function filterPreProductionQCId() {
        var valThis = $('#txtSearchValuePreProductionQCId').val();
        $('.dropdown-select ul > li').each(function () {
            var text = $(this).text();
            (text.toLowerCase().indexOf(valThis.toLowerCase()) > -1) ? $(this).show() : $(this).hide();
        });
    };
    // Event listeners

    // Open/close
    $(document).on('click', '.dropdown-select', function (event) {
        if ($(event.target).hasClass('dd-searchbox')) {
            return;
        }
        $('.dropdown-select').not($(this)).removeClass('open');
        $(this).toggleClass('open');
        if ($(this).hasClass('open')) {
            $(this).find('.option').attr('tabindex', 0);
            $(this).find('.selected').focus();
        } else {
            $(this).find('.option').removeAttr('tabindex');
            $(this).focus();
        }
    });

    // Close when clicking outside
    $(document).on('click', function (event) {
        if ($(event.target).closest('.dropdown-select').length === 0) {
            $('.dropdown-select').removeClass('open');
            $('.dropdown-select .option').removeAttr('tabindex');
        }
        event.stopPropagation();
    });
    // Option click
    $(document).on('click', '.dropdown-select .option', function (event) {
        $(this).closest('.list').find('.selected').removeClass('selected');
        $(this).addClass('selected');
        var text = $(this).data('display-text') || $(this).text();
        $(this).closest('.dropdown-select').find('.current').text(text);
        $(this).closest('.dropdown-select').prev('select').val($(this).data('value')).trigger('change');
    });

    // Keyboard events
    $(document).on('keydown', '.dropdown-select', function (event) {
        var focused_option = $($(this).find('.list .option:focus')[0] || $(this).find('.list .option.selected')[0]);
        // Space or Enter
        //if (event.keyCode == 32 || event.keyCode == 13) {
        if (event.keyCode == 13) {
            if ($(this).hasClass('open')) {
                focused_option.trigger('click');
            } else {
                $(this).trigger('click');
            }
            return false;
            // Down
        } else if (event.keyCode == 40) {
            if (!$(this).hasClass('open')) {
                $(this).trigger('click');
            } else {
                focused_option.next().focus();
            }
            return false;
            // Up
        } else if (event.keyCode == 38) {
            if (!$(this).hasClass('open')) {
                $(this).trigger('click');
            } else {
                var focused_option = $($(this).find('.list .option:focus')[0] || $(this).find('.list .option.selected')[0]);
                focused_option.prev().focus();
            }
            return false;
            // Esc
        } else if (event.keyCode == 27) {
            if ($(this).hasClass('open')) {
                $(this).trigger('click');
            }
            return false;
        }
    });

    /*Shweta added 'function create_custom_dropdowns()' 22-06-2023. end*/

    //Rahul 19 Apr 23.
    $(document).ready(function () {
        $("#divInwardQC").show();
        $("#divProductionQC").hide();   
        //For deleting the rows of Item table if exist.       
        var table = document.getElementById('ItemTable');
        var rowCount = table.rows.length;
        while (rowCount != '1') {
            var row = table.deleteRow(rowCount - 1);
            rowCount--;
        }
        //call for deop down 
        create_custom_dropdowns_InwardQCId();
        create_custom_dropdowns_PreProductionQCId();    
    });
    
   //Rahul 18 Apr 23.
    $('#QCType').change(function () {
        var QCType = $('#QCType option:selected').attr('value');
        if (QCType == 'InwardQC') {
            $("#divInwardQC").show();
            $("#divProductionQC").hide();
            $("#TotalQtyTextChange").text("Total Quantity");
            $("#InwardQtyTextChange").text("Inward Quantity");
            //For deleting the rows of Item table if exist.       
            var table = document.getElementById('ItemTable');
            var rowCount = table.rows.length;
            while (rowCount != '1') {
                var row = table.deleteRow(rowCount - 1);
                rowCount--;
            }           
            document.getElementById('InwardQCId').selectedIndex = 0;
            $("#PONumber").val("");
            $("#SupplierName").val("");
            $('#ValMsgInwardQCNumber').hide();  ///Rahul added 19-04-23. 
            $('#ValMgssuppliername').hide();
            $('#ValMsgPONumber').hide();
            $('#btnSave').prop('disabled', false); ///Rahul added 27-04-23. 
        }
        else {
            $("#divInwardQC").hide();
            $("#divProductionQC").show();
            $("#TotalQtyTextChange").text("Production Indent Quantity");
            $("#InwardQtyTextChange").text("Material Issue Quantity");
            //For deleting the rows of Item table if exist.       
            var table = document.getElementById('ItemTable');
            var rowCount = table.rows.length;
            while (rowCount != '1') {
                var row = table.deleteRow(rowCount - 1);
                rowCount--;
            }
            document.getElementById('PreProductionQCId').selectedIndex = 0;
            $("#ProductionIndentNo").val("");
            $('#ValMsgProductionQCNumber').hide(); //19 Apr 2023. 
            $('#ValMsgProductionIndentNumber').hide(); //19 Apr 2023.
            $('#btnSave').prop('disabled', false); ///Rahul added 27-04-23. 
        }
    });

    var InwardQuantities = "";
    @*//Rahul 18 Apr 23.*@
    ///---Rahul added onmouseleave event ValMsgInwardQCNumber(value, id) strart 09-02-2023.
    //function ValMsgInwardQCNumber(value, id) {
    //    //debugger
    //    var InwardQCNumber = $("#InwardQCId option:selected").val();
    //    if (InwardQCNumber == '' || InwardQCNumber == 0) {
    //        $("#ValMsgInwardQCNumber").text("Please select Inward QC number!");
    //        $("#ValMsgInwardQCNumber").show();
    //        document.getElementById(id).focus();
    //        return
    //    }
    //    else {
    //        $("#ValMsgInwardQCNumber").hide();
    //    }
    //}
    ///---Rahul added onmouseleave event ValMsgInwardQCNumber(value, id) end.

    function SelectedIndexChanged(id) {

        $('#ValMsgInwardQCNumber').hide();  ///Rahul added 19-04-23. 
        $('#ValMgssuppliername').hide();
        $('#ValMsgPONumber').hide();
        var InwardNumber = $("#InwardQCId option:selected").text();
        
        var InwNumQcNumSplit = InwardNumber.split(' (');
        document.getElementById("InwardQCNumber").value = InwNumQcNumSplit[0];
        var tempInwNumQcNumSplit = InwNumQcNumSplit[1].split(')'); 
        document.getElementById("InwardNoteNumber").value = tempInwNumQcNumSplit[0];

        //For deleting the rows of Item table if exist.       
        var table = document.getElementById('ItemTable');
        var rowCount = table.rows.length;
        while (rowCount != '1') {
            var row = table.deleteRow(rowCount - 1);
            rowCount--;
        }
        //Clearing the address textarea
        $('#SupplierName').val(' ');        
        $.ajax({
            type: "POST",
            url: `/RejectionNote/BindInwardDetails?id=` + id,
            data: "{ }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                console.log("InwDetails :", result);
                $('#PO_Id').val(result[0].PO_Id);
                $('#PONumber').val(result[0].PONumber);
                $('#SupplierName').val(result[0].SupplierName);
                $('#SupplierID').val(result[0].SupplierID); /// Rahul added SupplierID 10-01-2023.
                var ColCount = result.length
                //$('#btnSave').prop('disabled', true); //Rahul added 27-04-23. 
                var flag1 = 0; //This flag is for checking whether the selected Inward QC is completed or not.
                if (result[0].flag == 1) {
                    debugger
                    alert("Rejection note is already created for the slelected Inward QC Number!");
                    $('#btnSave').prop('disabled', true); //Rahul added 27-04-23.
                    return
                }
                //===================Create dynamic table for binding Item details====================//
                var table = document.getElementById('ItemTable');
                for (var j = 1; j < result.length; j++) {
                    //debugger
                    var rowCount = table.rows.length;
                    var cellCount = table.rows[0].cells.length;
                    var row = table.insertRow(rowCount);
                    for (var i = 0; i < cellCount; i++) {
                        var cell = 'cell' + i;
                        cell = row.insertCell(i);
                        if (i == 0) {                            
                            cell.setAttribute("id", "ItemName_" + j);
                            cell.innerHTML = result[j].Item_Name;
                        }
                        else if (i == 1) {
                            cell.setAttribute("id", "ItemCode_" + j);
                            cell.innerHTML = result[j].Item_Code;
                        }
                        else if (i == 2) {
                            cell.setAttribute("id", "ItemUnitPrice_" + j);
                            cell.innerHTML = result[j].ItemUnitPrice + " " + result[j].CurrencyName;
                        }
                        else if (i == 3) {
                            cell.setAttribute("id", "ItemUnit_" + j);
                            cell.innerHTML = result[j].ItemUnit; 
                        }
                        else if (i == 4) {
                            cell.setAttribute("id", "ItemQty" + j);
                            cell.innerHTML = result[j].TotalQuantity + " " + result[j].ItemUnit; 
                        }
                        else if (i == 5) {
                            cell.setAttribute("id", "InwardQuantity_" + j); 
                            cell.innerHTML = result[j].InwardQuantity + " " + result[j].ItemUnit;
                        }
                        else if (i == 6) {                            
                            cell.setAttribute("id", "RejectedQuantity_" + j);
                            cell.innerHTML = result[j].RejectedQuantity;
                            //Rahul added 'RejQty' check if Zero then alert of if (flag1 == 0) 16-02-23. 
                            var RejQty = $("#RejectedQuantity_" + j).text();
                            if (RejQty != '0' && RejQty != '' && RejQty != null && RejQty != 'undefined') {                                
                                flag1 = 1;
                            }                            
                        }
                        else if (i == 7) {
                            cell.setAttribute("id", "QuantityTookForSorting_" + j); 
                            cell.innerHTML = result[j].QuantityTookForSorting + " " + result[j].ItemUnit;
                        }
                        else if (i == 8) {
                            cell.setAttribute("id", "WastageQuantityInPercentage_" + j); 
                            cell.innerHTML = result[j].WastageQuantityInPercentage.toFixed(4);
                        }
                        else if (i == 9) {
                            cell.setAttribute("id", "Remarks_" + j); 
                            cell.innerHTML = result[j].Remarks;                            
                        }
                        else if (i == 10) {
                            var t7 = document.createElement("input");
                            t7.id = "ItemID" + j;
                            t7.setAttribute("value", result[j].ItemId);
                            t7.setAttribute("disabled", "true");
                            t7.setAttribute("class", "d-none");
                            cell.appendChild(t7);
                            cell.setAttribute("style", "display:none"); //Rahul added 12-01-2023.
                        }
                        else if (i == 11) {
                            var t7 = document.createElement("input");
                            t7.id = "ItemTaxValue" + j;
                            t7.setAttribute("value", result[j].ItemTaxValue);
                            t7.setAttribute("disabled", "true");
                            t7.setAttribute("class", "d-none");
                            cell.appendChild(t7);
                            cell.setAttribute("style", "display:none"); //Rahul added 12-01-2023.
                        }
                    }

                }
                //Rahul added 'RejQty' check if Zero then alert of if (flag1 == 0) 16-02-23. 
                if (flag1 == 0) {
                    alert('Rejected Quantity is zero, Rejection Note can not be created for the selected Inward QC number!');
                    $('#btnSave').prop('disabled', 'true');
                }
                else {
                    $('#btnSave').prop('disabled', false);
                }
            },//Rahul added 'error: function (err)' 27-04-23.
            error: function (err) {
                alert('Not able to fetch Rejection Note item details!');
                $('#btnSave').prop('disabled', true); 
            }
        });
    }

    function createJson() {        
        var table = document.getElementById('ItemTable');
        var rowCount = table.rows.length;
        var i = 1;
        InwardQuantities = "[";
        //BalanceQuantities = ""; 
        for (i = 1; i < rowCount; i++) {            
            var cellData = document.getElementById("ItemName_" + i);
            var ItemName = cellData.innerHTML;
                        
            var cellData = document.getElementById("ItemCode_" + i);
            var ItemCode = cellData.innerHTML;

            var cellData = document.getElementById("ItemUnitPrice_" + i);
            var UnitPrice = cellData.innerHTML.split(' ');
            var CurrencyName = UnitPrice[1]; UnitPrice = UnitPrice[0];
                        
            var cellData = document.getElementById("ItemUnit_" + i);
            var Unit = cellData.innerHTML;

            var cellData = document.getElementById("ItemQty" + i);
            var POQty = cellData.innerHTML.split(' ');
            var Unit = POQty[1]; POQty = POQty[0];

            var cellData = document.getElementById("InwardQuantity_" + i);
            var InwQty = cellData.innerHTML.split(' ');
            var Unit = InwQty[1]; InwQty = InwQty[0];
                        
            var cellData = document.getElementById("RejectedQuantity_" + i);
            var RejectedQuantity = cellData.innerHTML;

            var cellData = document.getElementById("QuantityTookForSorting_" + i);
            var QtyTookForSrt = cellData.innerHTML.split(' ');
            var Unit = QtyTookForSrt[1]; QtyTookForSrt = QtyTookForSrt[0];
                        
            var cellData = document.getElementById("WastageQuantityInPercentage_" + i);
            var WastageQuantityInPercentage = cellData.innerHTML;

            var cellData = document.getElementById("Remarks_" + i);
            var Remarks = cellData.innerHTML; 

            var ItemID = $('#ItemID' + i).val();
            var Tax = $('#ItemTaxValue' + i).val(); Tax = Tax.split(" "); Tax = Tax[0];
            if (Tax == '' || Tax == null) {
                Tax = 0;    
            }
            InwardQuantities = InwardQuantities + "{\"Item_Name\": \"" + ItemName + "\", \"Item_Code\": \"" + ItemCode + "\",\"ItemUnitPrice\": "
                + UnitPrice + ", \"ItemUnit\": \"" + Unit + "\",\"TotalQuantity\": " + POQty + ",\"InwardQuantity\":" + InwQty + ",\"RejectedQuantity\": "
                + RejectedQuantity + ", \"QtyTookForSrt\": " + QtyTookForSrt + ",\"WastageQuantityInPercentage\": "
                + WastageQuantityInPercentage + ",\"Remarks\": \"" + Remarks + "\",\"ItemId\":" + ItemID + ",\"ItemTaxValue\": "
                + Tax + ", \"CurrencyName\": \"" + CurrencyName + "\"";
                   
            
            if (i == (rowCount - 1))
                InwardQuantities = InwardQuantities + "}";
            else
                InwardQuantities = InwardQuantities + "},";
        }
        InwardQuantities = InwardQuantities + "]";
        //console.log("InwardQuantities: ", InwardQuantities)
        //$('#InwardQuantities').val();        
    }

    function SetInwardQty() {
        ///Rahul added 21-04-23.
        debugger
        var QCType = $('#QCType option:selected').attr('value');
        if (QCType == 'InwardQC') {
            $("#divInwardQC").show();
            $("#divProductionQC").hide();
        
            if ($('#InwardQCId').val() == '' || $('#InwardQCId').val() == null) {
                $('#ValMsgInwardQCNumber').show();
                $('#ValMsgInwardQCNumber').text('Please select Inward QC number!');
                document.getElementById('ValMsgInwardQCNumber').setAttribute('style', 'color:text;');
                $('#ValMgssuppliername').show();
                $('#ValMgssuppliername').text('Supplier Name requred!');
                document.getElementById('ValMgssuppliername').setAttribute('style', 'color:text;');
                $('#ValMsgPONumber').show();
                $('#ValMsgPONumber').text('PO Number required!');
                document.getElementById('ValMsgPONumber').setAttribute('style', 'color:text;');

                event.preventDefault();
                return;
            }
        }
        else {
            $("#divInwardQC").hide();
            $("#divProductionQC").show();
            
            if ($('#PreProductionQCId').val() == '' || $('#PreProductionQCId').val() == null) {
                $('#ValMsgProductionQCNumber').show(); //19 Apr 2023.
                $('#ValMsgProductionQCNumber').text('Please select Production QC number!');
                document.getElementById('ValMsgInwardQCNumber').setAttribute('style', 'color:text;');
                $('#ValMsgProductionIndentNumber').show(); //19 Apr 2023.
                $('#ValMsgProductionIndentNumber').text('Production Indent number required!');
                document.getElementById('ValMgssuppliername').setAttribute('style', 'color:text;');
                event.preventDefault();
                return;
            }
        }

        createJson();        
        $('#InwardQuantities').val(InwardQuantities);
        //alert($('#InwardQuantities').val());        
    }
    ///Rahul 'SelectedIndexChangedProduction' 18 Apr 2023 start.
    function SelectedIndexChangedProduction(id) {
        $('#ValMsgProductionQCNumber').hide(); //19 Apr 2023. 
        $('#ValMsgProductionIndentNumber').hide(); //19 Apr 2023.
        var PreProductionQCNumber = $("#PreProductionQCId option:selected").text();

        var PreProductionQcNumSplit = PreProductionQCNumber.split(' (');
        document.getElementById("PreProductionQCNumber").value = PreProductionQcNumSplit[0];
        var tempPreProductionQcNumSplit = PreProductionQcNumSplit[1].split(')');
        document.getElementById("ProductionMaterialIssueNoteNo").value = tempPreProductionQcNumSplit[0];

        //For deleting the rows of Item table if exist.       
        var table = document.getElementById('ItemTable');
        var rowCount = table.rows.length;
        while (rowCount != '1') {
            var row = table.deleteRow(rowCount - 1);
            rowCount--;
        }
        //Clearing the address textarea
        $('#SupplierName').val(' ');
        $.ajax({
            type: "POST",
            url: `/RejectionNote/ProdIndent_NoDeatils?id=` + id,
            data: "{ }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                $('#ProductionIndentNo').val(result[0].ProductionIndentNo);
                $('#ProductionIndentId').val(result[0].ProductionIndentID);
                $('#ProductionMaterialIssueNoteId').val(result[0].ID);
                var ColCount = result.length
                var flag1 = 0; //This flag is for checking whether the selected Inward QC is completed or not.
                $('#btnSave').prop('disabled', true); //Rahul added 27-04-23.
                if (result[0].flag == 1) {
                    alert("Rejection note is already created for the slelected Pre-Production QC Number!");
                    $('#btnSave').prop('disabled', true); //Rahul added 27-04-23.
                    return
                }
                //===================Create dynamic table for binding Item details====================//
                var table = document.getElementById('ItemTable');
                for (var j = 1; j < result.length; j++) {
                    //debugger
                    var rowCount = table.rows.length;
                    var cellCount = table.rows[0].cells.length;
                    var row = table.insertRow(rowCount);
                    for (var i = 0; i < cellCount; i++) {
                        var cell = 'cell' + i;
                        cell = row.insertCell(i);
                        if (i == 0) {
                            cell.setAttribute("id", "ItemName_" + j);
                            cell.innerHTML = result[j].Item_Name;
                        }
                        else if (i == 1) {
                            cell.setAttribute("id", "ItemCode_" + j);
                            cell.innerHTML = result[j].Item_Code;
                        }
                        else if (i == 2) {
                            cell.setAttribute("id", "ItemUnitPrice_" + j);
                            cell.innerHTML = result[j].ItemUnitPrice + " " + result[j].CurrencyName;
                        }
                        else if (i == 3) {
                            cell.setAttribute("id", "ItemUnit_" + j);
                            cell.innerHTML = result[j].ItemUnit;
                        }
                        else if (i == 4) {
                            cell.setAttribute("id", "ItemQty" + j);
                            cell.innerHTML = result[j].TotalQuantity + " " + result[j].ItemUnit;
                        }
                        else if (i == 5) {
                            cell.setAttribute("id", "InwardQuantity_" + j);
                            cell.innerHTML = result[j].IssuedQuantity + " " + result[j].ItemUnit;
                        }
                        else if (i == 6) {
                            cell.setAttribute("id", "RejectedQuantity_" + j);
                            cell.innerHTML = result[j].RejectedQuantity;
                            //Rahul added 'RejQty' check if Zero then alert of if (flag1 == 0) 16-02-23. 
                            var RejQty = $("#RejectedQuantity_" + j).text();
                            if (RejQty != '0' && RejQty != '' && RejQty != null && RejQty != 'undefined') {
                                flag1 = 1;
                            }
                        }
                        else if (i == 7) {
                            cell.setAttribute("id", "QuantityTookForSorting_" + j);
                            cell.innerHTML = result[j].QuantityTookForSorting + " " + result[j].ItemUnit;
                        }
                        else if (i == 8) {
                            cell.setAttribute("id", "WastageQuantityInPercentage_" + j);
                            cell.innerHTML = result[j].WastageQuantityInPercentage.toFixed(4);
                        }
                        else if (i == 9) {
                            cell.setAttribute("id", "Remarks_" + j);
                            cell.innerHTML = result[j].Remarks;
                        }
                        else if (i == 10) {
                            var t7 = document.createElement("input");
                            t7.id = "ItemID" + j;
                            t7.setAttribute("value", result[j].ItemId);
                            t7.setAttribute("disabled", "true");
                            t7.setAttribute("class", "d-none");
                            cell.appendChild(t7);
                            cell.setAttribute("style", "display:none"); //Rahul added 12-01-2023.
                        }
                        else if (i == 11) {
                            var t7 = document.createElement("input");
                            t7.id = "ItemTaxValue" + j;
                            t7.setAttribute("value", result[j].ItemTaxValue);
                            t7.setAttribute("disabled", "true");
                            t7.setAttribute("class", "d-none");
                            cell.appendChild(t7);
                            cell.setAttribute("style", "display:none"); //Rahul added 12-01-2023.
                        }
                    }

                }
                //Rahul added 'RejQty' check if Zero then alert of if (flag1 == 0) 16-02-23. 
                if (flag1 == 0) {
                    alert('Rejected Quantity is zero, Rejection Note can not be created for the selected Pre-Production QC number!');
                    $('#btnSave').prop('disabled', 'true');
                }
                else {
                    $('#btnSave').prop('disabled', false);
                }
            },//Rahul added 'error: function (err)' 27-04-23.
            error: function (err) {
                alert('Not able to fetch Rejection Note item details!');
                $('#btnSave').prop('disabled', true);
            }
        });
    }
    ///Rahul 'SelectedIndexChangedProduction' 18 Apr 2023 end.
</script>

@Html.Raw(TempData["Success"])
